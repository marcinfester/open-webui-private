---
description: 
globs: 
alwaysApply: true
---
---
description: Open WebUI Project Architecture Context.
globs: []
alwaysApply: true
---

# Open WebUI Project Architecture Context

## @project
Celem tego pliku jest dostarczenie kontekstu architektonicznego dla AI.
Open WebUI to samo-hostowana platforma AI o architekturze Full-Stack.

- **Frontend**: SvelteKit + TypeScript
- **Backend**: FastAPI + Python
- **GÅ‚Ã³wne cele**: ModularnoÅ›Ä‡, praca w trybie offline, integracja RAG, obsÅ‚uga multimediÃ³w.

## @stack
- **Frontend**: Svelte 4.2+, SvelteKit 2.5+, TypeScript 5.5+
- **Backend**: FastAPI 0.115.7+, Python 3.11+, Pydantic 2.10+, SQLAlchemy 2.0+
- **Baza danych**: PostgreSQL/SQLite + Bazy wektorowe (np. ChromaDB)
- **AI/ML**: Ollama, OpenAI, Gemini, Anthropic, Transformers, Whisper

## @filetree
Kluczowa struktura plikÃ³w i katalogÃ³w w projekcie.

open-webui-private/
â”œâ”€â”€ ğŸ“ backend/                  # Backend FastAPI
â”‚   â””â”€â”€ open_webui/
â”‚       â”œâ”€â”€ main.py              # GÅ‚Ã³wny plik aplikacji (entry point)
â”‚       â”œâ”€â”€ config.py            # Centralna konfiguracja
â”‚       â”œâ”€â”€ ğŸ“ routers/          # Logika API (24 moduÅ‚y)
â”‚       â”‚   â”œâ”€â”€ auths.py         # Uwierzytelnianie
â”‚       â”‚   â”œâ”€â”€ chats.py         # ZarzÄ…dzanie czatami
â”‚       â”‚   â”œâ”€â”€ ollama.py        # Integracja z Ollama
â”‚       â”‚   â”œâ”€â”€ retrieval.py     # Logika RAG i wyszukiwanie wektorowe
â”‚       â”‚   â”œâ”€â”€ audio.py         # Przetwarzanie audio (STT/TTS)
â”‚       â”‚   â””â”€â”€ images.py        # Generowanie obrazÃ³w
â”‚       â”œâ”€â”€ ğŸ“ models/           # Modele danych (Pydantic/SQLAlchemy)
â”‚       â”‚   â”œâ”€â”€ users.py
â”‚       â”‚   â””â”€â”€ chats.py
â”‚       â””â”€â”€ ğŸ“ utils/             # Funkcje pomocnicze backendu
â”‚
â”œâ”€â”€ ğŸ“ src/                       # Frontend SvelteKit
â”‚   â”œâ”€â”€ ğŸ“ lib/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ apis/              # Warstwa komunikacji z API
â”‚   â”‚   â”‚   â””â”€â”€ index.ts         # GÅ‚Ã³wny klient API
â”‚   â”‚   â”œâ”€â”€ ğŸ“ components/        # Komponenty UI
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ chat/          # Interfejs czatu (MessageInput, Messages)
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ admin/         # Panel administratora
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ workspace/     # ZarzÄ…dzanie treÅ›ciÄ… (baza wiedzy, prompty)
â”‚   â”‚   â”œâ”€â”€ ğŸ“ stores/            # ZarzÄ…dzanie stanem (Svelte Stores)
â”‚   â”‚   â”‚   â””â”€â”€ index.ts         # Centralne stores
â”‚   â”‚   â”œâ”€â”€ ğŸ“ types/             # Definicje typÃ³w TypeScript
â”‚   â”‚   â””â”€â”€ ğŸ“ utils/             # Funkcje pomocnicze frontendu
â”‚   â””â”€â”€ ğŸ“ routes/                # Routing oparty na plikach (SvelteKit)
â”‚       â””â”€â”€ ğŸ“ (app)/             # Chronione trasy aplikacji
â”‚
â”œâ”€â”€ pyproject.toml               # ZaleÅ¼noÅ›ci backendu (Python)
â””â”€â”€ package.json                 # ZaleÅ¼noÅ›ci frontendu (Node.js)

## @rules
Podczas generowania lub modyfikacji kodu, trzymaj siÄ™ poniÅ¼szych zasad i wzorcÃ³w.

### Frontend (Svelte + TypeScript)
1.  **Routing**: Nowe strony aplikacji umieszczaj w `src/routes/(app)/`. Routing jest oparty na systemie plikÃ³w SvelteKit.
2.  **ZarzÄ…dzanie stanem**: Globalny stan aplikacji jest zarzÄ…dzany przez Svelte Stores w `src/lib/stores/index.ts`. UÅ¼ywaj istniejÄ…cych lub dodawaj nowe, jeÅ›li to konieczne.
3.  **Komunikacja z API**: CaÅ‚a komunikacja z backendem odbywa siÄ™ przez warstwÄ™ API zdefiniowanÄ… w `src/lib/apis/`. GÅ‚Ã³wny plik to `index.ts`. Dodawaj nowe funkcje do istniejÄ…cych, modularnych wrapperÃ³w.
4.  **Komponenty**: TwÃ³rz reuÅ¼ywalne, dobrze zdefiniowane komponenty. GÅ‚Ã³wne komponenty interfejsu znajdujÄ… siÄ™ w `src/lib/components/chat/`.
5.  **Typowanie**: Utrzymuj silne typowanie. Definicje globalnych typÃ³w znajdujÄ… siÄ™ w `src/lib/types/`.

### Backend (FastAPI + Python)
1.  **Logika biznesowa**: LogikÄ™ biznesowÄ… i obsÅ‚ugÄ™ endpointÃ³w umieszczaj w dedykowanych routerach w katalogu `backend/open_webui/routers/`.
2.  **Modele danych**: Do definiowania schematÃ³w bazy danych uÅ¼ywaj modeli SQLAlchemy, a do walidacji danych przychodzÄ…cych z API modeli Pydantic. ZnajdujÄ… siÄ™ one w `backend/open_webui/models/`.
3.  **Konfiguracja**: Centralny plik konfiguracyjny to `backend/open_webui/config.py`. Zmienne Å›rodowiskowe sÄ… preferowanym sposobem konfiguracji.
4.  **AsynchronicznoÅ›Ä‡**: CaÅ‚y backend jest asynchroniczny. UÅ¼ywaj `async/await` we wszystkich operacjach I/O.
5.  **Wzorce**: Unikaj umieszczania zÅ‚oÅ¼onej logiki bezpoÅ›rednio w endpointach routera. RozwaÅ¼ uÅ¼ycie wzorca warstwy serwisowej (Service Layer) dla bardziej skomplikowanych operacji.

### OgÃ³lny przepÅ‚yw danych
1.  **Akcja uÅ¼ytkownika** w komponencie Svelte (`src/lib/components`).
2.  **WywoÅ‚anie funkcji** z warstwy API (`src/lib/apis/index.ts`).
3.  **Å»Ä…danie HTTP** trafia do odpowiedniego routera FastAPI (`backend/routers/*.py`).
4.  Router przetwarza Å¼Ä…danie, wykorzystujÄ…c **modele Pydantic** do walidacji.
5.  Router wykonuje operacje na **modelach SQLAlchemy** i komunikuje siÄ™ z bazÄ… danych lub zewnÄ™trznymi API (np. Ollama).
6.  OdpowiedÅº jest zwracana do frontendu.
7.  **Svelte Store** (`src/lib/stores/index.ts`) jest aktualizowany, co powoduje reaktywne odÅ›wieÅ¼enie UI.
